<%-include('./partials/user-header') %>
<%-include('./partials/user-nav') %>


    <div
      id="resetPasswordModal"
      class="modal fade"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content text-center">
          <span
            class="close"
            id="closeModal"
            style="font-size: 30px; cursor: pointer"
            >&times;</span
          >
          <h2 class="text-center">Reset Password</h2>
          <form id="resetPasswordForm">
            <label for="username" class="visually-hidden"
              >Username or Email:</label
            >
            <input
              type="text"
              id="username"
              name="username"
              class="visually-hidden"
              aria-hidden="true"
            />
            <br />
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input
                type="password"
                class="form-control"
                id="newPassword"
                placeholder="New Password"
                autocomplete="new-password"
              />
            </div>
            <br />
            <div class="form-group">
              <label for="confirmNewPassword">Confirm New Password</label>
              <input
                type="password"
                class="form-control"
                id="confirmNewPassword"
                placeholder="Confirm New Password"
                autocomplete="new-password"
              />
            </div>
            <br />
            <div class="form-group" style="margin-bottom: 20px">
              <button type="submit" class="btn btn-dark">Reset Password</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-4">
          <div class="card shadow border mt-5 ms-5">
            <div class="card-body">
              <div class="border-right">
                <div
                  class="profile-pic d-flex flex-column align-items-center text-center py-5"
                >
                  <div class="d-flex justify-content-center ms-5">
                    <label
                      class="form-label text-white m-1"
                      for="customFile2"
                    ></label>
                    <input
                      type="file"
                      accept="image/*"
                      id="imageinput"
                      onchange="uploadProfilePicture(event)"
                    />
                  </div>
                  <br />

                  <div class="profilePhoto">
                    <img
                      class="rounded-circle mt-5 img-fluid"
                      width="150px"
                      src="/profile-images/cropped_images/<%= profile.profilePhoto || 'https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg' %>"
                      id="selectedAvathar"
                      alt="Default Image"
                      style="object-fit: cover"
                    />
                  </div>

                  <span class="font-weight-bold"
                    ><b><%= profile.name %></b></span
                  >
                  <span class="text-black-50"><%= profile.email %></span>
                </div>
                <div class="d-flex justify-content-center">
                  <button id="resetPasswordButton" class="btn btn-dark">
                    Reset Password
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="card shadow border mt-5 me-5">
            <div class="card-body">
              <form id="profileForm">
                <div class="p-3 py-2">
                  <div
                    class="d-flex justify-content-center align-items-center mb-4"
                  >
                    <h3 class="text-right">Profile Settings</h3>
                  </div>

                  <div class="col-md-12">
                    <label class="labels">Name :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      placeholder="Name"
                      value="<%= profile.name %>"
                    />
                  </div>
                  <div class="col-md-12">
                    <label class="labels">Email :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="email"
                      placeholder="Email"
                      value="<%= profile.email %>"
                    />
                  </div>
                  <!-- <div class="col-md-12">
                    <label class="labels">Phone Number :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="phone"
                      placeholder="Phone Number"
                      value=""
                    />
                  </div> -->
                  <br />
                </div>

                <div class="d-flex justify-content-around">
                  <div class="cardHeader d-flex">
                    <button type="submit" class="btn btn-dark">
                      Save Changes
                    </button>
                  </div>

                  <div class="cardHeader d-flex">
                    <a href="/userprofile" class="btn btn-dark">Cancel</a>
                  </div>
                </div>
                <br />
              </form>

              <div class="d-flex justify-content-center">
                <div class="d-flex align-items-center" style="width: 470px">
                  <div class="input-group mb-3 d-flex">
                    <div class="d-flex align-items-center mt-2">
                      <h6 class="bg-" style="color: #000000">
                        Referral Link:
                      </h6>
                    </div>
                    <div>
                      <input
                        type="text"
                        class="form-control"
                        id="referralLink"
                        value=""
                        readonly
                        style="
                          font-size: 16px;
                          color: #495057;
                          background-color: #f8f9fa;
                          width: 100%;
                        "
                      />
                    </div>
                    <div class="">
                      <button
                        class="btn btn-outline-dark"
                        type="button"
                        onclick="copyReferralLink()"
                        style="font-size: 16px"
                      >
                        Copy
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <br />
            </div>
          </div>
        </div>

        <div class="col-md-12">
          <!-- <div class="row"> -->
          <div class="card shadow border mt-5 ms-5 me-5">
            <div class="card-body d-flex">
              <div class="col-md-2 m-4">
                <a
                  href="/user/trackOrder"
                  style="text-decoration: none; color: black"
                >
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />
                      <i
                        class="fa-solid fa-clock-rotate-left fa-2xl"
                        style="color: #000000"
                      ></i>
                      <br />
                      <h5>Orders History</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-2 m-4">
                <a href="/cart" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />
                      <i
                        class="fa-solid fa-cart-shopping fa-2xl"
                        style="color: #000000"
                      ></i>
                      <br />
                      <h5>Cart</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-2 m-4">
                <a href="/address" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />
                      <i
                        class="fa-solid fa-location-dot fa-2xl"
                        style="color: #00060f"
                      ></i>
                      <br />
                      <h5>Address</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-2 m-4">
                <a href="/wishlist" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />

                      <i
                        class="fa-solid fa-heart fa-2xl"
                        style="color: #000000"
                      ></i>
                      <br />
                      <h5>Wishlist</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-2 m-4">
                <a href="/coupoun" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />

                      <i
                        class="fa-solid fa-link fa-2xl"
                        style="color: #000000"
                      ></i>
                      <br />
                      <h5>Coupons</h5>
                    </div>
                  </div>
                </a>
              </div>

              <!-- <div class="col-md-2">
                <div class="card shadow border">
                  <div class="card-body justify-content-center">
                    <a href="/accountSettings" style="text-decoration: none; color: black;">
                    <i
                      class="fa-solid fa-user fa-2xl"
                      style="color: #000000"
                    ></i>
                    <h6>Account Settings</h6>
                    </a>
                  </div>
                </div>
              </div> -->
            </div>
          </div>
          <!-- </div> -->
        </div>
      </div>
    </div>
    <br />
    <br />

    <script>
      var loadFile = function (event) {
        var image = document.getElementById("output");
        image.src = URL.createObjectURL(event.target.files[0]);
      };

      function copyReferralLink() {
        const referralLinkInput = document.getElementById("referralLink");
        referralLinkInput.select();
        document.execCommand("copy");
        alert("Referral link copied to clipboard!");
      }

      document
        .getElementById("profileForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          // const phone = document.getElementById("phone").value;

          const formData = {
            name: name,
            email: email,
            // phone: phone,
          };

          fetch("/updateProfile", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Profile updated successfully!");
              } else {
                alert("Failed to update profile.");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });

      const modal = new bootstrap.Modal(
        document.getElementById("resetPasswordModal"),
        {
          keyboard: false,
        }
      );

      document
        .getElementById("resetPasswordButton")
        .addEventListener("click", () => {
          modal.show();
        });

      document.getElementById("closeModal").addEventListener("click", () => {
        modal.hide();
      });

      document
        .getElementById("resetPasswordForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const newPassword = document.getElementById("newPassword").value;
          const confirmNewPassword =
            document.getElementById("confirmNewPassword").value;

          if (newPassword === confirmNewPassword) {
            const formData = {
              newPassword: newPassword,
            };

            fetch("/userPasswordReset", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  alert("Password reset successful!");
                  location.reload();
                } else {
                  alert("Failed to reset password.");
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          } else {
            alert("Passwords do not match. Please check and try again.");
          }
        });

      function uploadProfilePicture(event) {
        const fileInput = event.target;
        const file = fileInput.files[0];

        const formData = new FormData();
        formData.append("profilePicture", file);

        fetch("/uploadProfilePicture", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              const avatarImage = document.getElementById("selectedAvathar");
              avatarImage.src = URL.createObjectURL(file);
              alert("Profile picture updated successfully!");
            } else {
              alert("Failed to update profile picture.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>


<%-include('./partials/user-footer') %>
 

