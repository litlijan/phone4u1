<%-include('./partials/user-header') %>
<%-include('./partials/user-nav') %>


    <div
      id="resetPasswordModal"
      class="modal fade"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content text-center">
          <span
            class="close"
            id="closeModal"
            style="font-size: 30px; cursor: pointer"
            >&times;</span
          >
          <h2 class="text-center">Reset Password</h2>
          <form id="resetPasswordForm">
            <label for="username" class="visually-hidden"
              >Username or Email:</label
            >
            <input
              type="text"
              id="username"
              name="username"
              class="visually-hidden"
              aria-hidden="true"
            />
            <br />
            <div class="form-group">
              <label for="newPassword" >Current Password</label>
              <input
                type="password"
                class="form-control"
                id="currentPassword"
                placeholder="Current Password"
                autocomplete="Current-Password"
              />
            </div>
            <br />
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input
                type="password"
                class="form-control"
                id="newPassword"
                placeholder="New Password"
                autocomplete="new-password"
              />
            </div>
            <br />
            <div class="form-group">
              <label for="confirmNewPassword">Confirm New Password</label>
              <input
                type="password"
                class="form-control"
                id="confirmNewPassword"
                placeholder="Confirm New Password"
                autocomplete="new-password"
              />
            </div>
            <br />
            <div class="form-group" style="margin-bottom: 20px">
              <button type="submit" class="btn btn-dark">Reset Password</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-4">
          <div class="card shadow border mt-5 ms-5">
            <div class="card-body">
              <div class="border-right">
                <div
                  class="profile-pic d-flex flex-column align-items-center text-center py-5"
                >
                <div class="d-flex justify-content-center ms-5">
                  <!-- <label class="form-label text-white m-1" for="customFile2"></label> -->
                  <!-- <input type="file" accept="image/*" id="imageinput" onchange="uploadProfilePicture(event)" /> -->
              </div>
              <br />

              <!-- <div class="profilePhoto">
                <img class="rounded-circle mt-5 img-fluid" width="150px"
                     src="/images/<%= profile.profilePhoto || 'default-image.jpg' %>"
                     id="selectedAvathar"
                     alt="Default Image"
                     style="object-fit: cover"/>
            </div> -->

                  <span class="font-weight-bold"
                    ><b><%= profile.name %></b></span
                  >
                  <span class="text-black-50"><%= profile.email %></span>
                </div>
                <div class="d-flex justify-content-center">
                  <button id="resetPasswordButton" class="btn btn-dark">
                    Reset Password
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="card shadow border mt-5 me-5">
            <div class="card-body">
              <form id="profileForm">
                <div class="p-3 py-2">
                  <div
                    class="d-flex justify-content-center align-items-center mb-4"
                  >
                    <h3 class="text-right">Profile Settings</h3>
                  </div>

                  <div class="col-md-12">
                    <label class="labels">Name :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      placeholder="Name"
                      value="<%= profile.name %>"
                    />
                  </div>
                  <div class="col-md-12">
                    <label class="labels">Email :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="email"
                      placeholder="Email"
                      value="<%= profile.email %>"
                    />
                  </div>

                </div>

                <div class="d-flex justify-content-around">
                  <div class="cardHeader d-flex">
                    <button type="submit" class="btn btn-dark">
                      Save Changes
                    </button>
                  </div>

                  <div class="cardHeader d-flex">
                    <a href="/userprofile" class="btn btn-dark">Cancel</a>
                  </div>
                </div>
                <br />
              </form>

              <!-- <div class="d-flex justify-content-center">
                <div class="d-flex align-items-center" style="width: 470px">
                  <div class="input-group mb-3 d-flex">
                    <div class="d-flex align-items-center mt-2">
                      <h6 class="bg-" style="color: #000000">
                        Referral Link:
                      </h6>
                    </div>
                    <div>
                      <input
                        type="text"
                        class="form-control"
                        id="referralLink"
                        value=""
                        readonly
                        style="
                          font-size: 16px;
                          color: #495057;
                          background-color: #f8f9fa;
                          width: 100%;
                        "
                      />
                    </div>
                    <div class="">
                      <button
                        class="btn btn-outline-dark"
                        type="button"
                        onclick="copyReferralLink()"
                        style="font-size: 16px"
                      >
                        Copy
                      </button>
                    </div>
                  </div>
                </div>
              </div> -->

              <br />
            </div>
          </div>
        </div>

        <div class="col-md-12">
          
          <div class="card shadow border mt-5 ms-5 me-5">
            <div class="card-body d-flex justify-content-center">
              <div class="col-md-3 m-6">
                <a
                  href="/user/trackOrder"
                  style="text-decoration: none; color: black"
                >
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >

                      <br />
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-archive-fill" viewBox="0 0 16 16">
                        <path d="M12.643 15C13.979 15 15 13.845 15 12.5V5H1v7.5C1 13.845 2.021 15 3.357 15zM5.5 7h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1M.8 1a.8.8 0 0 0-.8.8V3a.8.8 0 0 0 .8.8h14.4A.8.8 0 0 0 16 3V1.8a.8.8 0 0 0-.8-.8z"/>
                      </svg>
                      <br />
                      <h5>Orders History</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-3 m-6">
                <a href="/user/cart" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-check-fill" viewBox="0 0 16 16">
                        <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0m7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-1.646-7.646-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L8 8.293l2.646-2.647a.5.5 0 0 1 .708.708"/>
                      </svg>
                      <br />
                      <h5>Cart</h5>
                    </div>
                  </div>
                </a>
              </div>

              <div class="col-md-3 m-6">
                <a href="/address" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill-add" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"/>
                      </svg>
                      <br />
                      <h5>Address</h5>
                    </div>
                  </div>
                </a>
              </div>


              <div class="col-md-3 m-6">
                <a href="/coupoun" style="text-decoration: none; color: black">
                  <div class="card shadow border">
                    <div
                      class="card-body d-flex flex-column align-items-center"
                    >
                      <br />

                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0"/>
                      </svg>
                      <br />
                      <h5>Coupons</h5>
                    </div>
                  </div>
                </a>
              </div>

              
            </div>
          </div>
          
        </div>
      </div>
    </div>
    <br />
    <br />

    <script>
      
      var loadFile = function (event) {
        var image = document.getElementById("output");
        image.src = URL.createObjectURL(event.target.files[0]);
      };

      function copyReferralLink() {
        const referralLinkInput = document.getElementById("referralLink");
        referralLinkInput.select();
        document.execCommand("copy");
        alert("Referral link copied to clipboard!");
      }

      document
        .getElementById("profileForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;

          
          const formData = {
            name: name,
            email: email,

          };

          fetch("/updateProfile", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Profile updated successfully!");
              } else {
                alert("Failed to update profile.");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });

      const modal = new bootstrap.Modal(
        document.getElementById("resetPasswordModal"),
        {
          keyboard: false,
        }
      );

      document
        .getElementById("resetPasswordButton")
        .addEventListener("click", () => {
          modal.show();
        });

      document.getElementById("closeModal").addEventListener("click", () => {
        modal.hide();
      });

      document
        .getElementById("resetPasswordForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const newPassword = document.getElementById("newPassword").value;
          const confirmNewPassword =
            document.getElementById("confirmNewPassword").value;

          if (newPassword === confirmNewPassword) {
            const formData = {
              newPassword: newPassword,
            };

            fetch("/userPasswordReset", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  alert("Password reset successful!");
                  location.reload();
                } else {
                  alert("Failed to reset password.");
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          } else {
            alert("Passwords do not match. Please check and try again.");
          }
        });

      function uploadProfilePicture(event) {
        const fileInput = event.target;
        const file = fileInput.files[0];

        const formData = new FormData();
        formData.append("profilePicture", file);

        fetch("/uploadProfilePicture", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              const avatarImage = document.getElementById("selectedAvathar");
              avatarImage.src = URL.createObjectURL(file);
              alert("Profile picture updated successfully!");
            } else {
              alert("Failed to update profile picture.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>


<%-include('./partials/user-footer') %>
 

